import{s as F,b as s,r as c,N as W,u as G,e as J,j as e,B as j,i as d}from"./index-57b17ab7.js";import{I as U,_ as a}from"./index-4b953b45.js";import{s as Z}from"./Otp-c4b2742c.js";import{T as b}from"./Typography-53e4a25e.js";import{T as q}from"./TextField-ebbc49f9.js";import"./useId-04df6fbd.js";import"./Menu-24ec4787.js";import"./useTheme-6c76255c.js";import"./List-19ca871a.js";import"./createSvgIcon-0c6544b4.js";const H="rzp_test_aekGbyIJxj3Z8i",K=F(s)(()=>({display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"70vh"})),st=()=>{const[C,k]=c.useState(""),[v,w]=c.useState(null),[u,T]=c.useState(!1),I=W(),{state:z}=I,{phoneNumber:O,totalPayableAmount:l,userAddress:o,startDate:P,endDate:S,count:D}=z||{},E=G(),_="+91"+O,r={...J(t=>t.wishDetails).data};r.BookingAmount=l,r.StartingDate=P,r.EndDate=S,r.TotalBookingDays=D,c.useEffect(()=>{const t=document.createElement("script");return t.src="https://checkout.razorpay.com/v1/checkout.js",t.async=!0,document.body.appendChild(t),()=>{document.body.removeChild(t)}},[]);const B=async()=>{try{const t=await Z(_);t?(w(t),T(!0)):a.error("failed to sent otp")}catch{a.error("failed to sent otp")}},N=async()=>{var t,f,h,y,x;try{await v.confirm(C),a("otp verified",{icon:"ðŸ‘"});const p={totalPayableAmount:l},n=await d.post("/booking/addbooking",r);if(((t=n==null?void 0:n.data)==null?void 0:t.status)===!0){const m=await d.post("/wish/payment",p),R=(h=(f=m==null?void 0:m.data)==null?void 0:f.order)==null?void 0:h.id,L=(x=(y=n==null?void 0:n.data)==null?void 0:y.booked)==null?void 0:x._id,V={key:H,amount:l*100,currency:"INR",name:"CanteenPro",description:"Complete canteen for all of them",order_id:R,handler:X=>{d.patch("/booking/confirmbooking",{bookingId:L}).then(i=>{var g;((g=i==null?void 0:i.data)==null?void 0:g.status)===!0&&E("/user/paymentsuccess")}).catch(i=>console.log(i))},prefill:{name:o==null?void 0:o.Name,city:o==null?void 0:o.City,contact:o==null?void 0:o.Phonenumber},notes:{address:o==null?void 0:o.District},theme:{color:"#3399cc"}};new window.Razorpay(V).open()}else a.error("can't book now, you have many active plans now!")}catch(p){console.log(p),a.error("incorrect otp")}};return e.jsxs(s,{children:[e.jsx(U,{position:"top-left",reverseOrder:!1}),e.jsxs(K,{children:[e.jsxs(s,{sx:{backgroundColor:"#17275F",width:"50%",display:"flex",justifyContent:"center",flexDirection:"column",borderRadius:"15px",padding:"2rem"},children:[e.jsx(b,{sx:{textAlign:"center",color:"white",fontWeight:700,fontSize:"24px"},children:"OTP Verification"}),e.jsx(b,{sx:{textAlign:"center",color:"white",fontWeight:400,fontSize:"16px",marginTop:"0.5rem"},children:"Verify your phone number"}),u?null:e.jsx("div",{id:"recaptcha"}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",marginTop:"1rem"},children:e.jsx(q,{label:"Enter OTP",variant:"standard",size:"small",InputLabelProps:{style:{color:"#E4E4E4",fontSize:"16px"}},InputProps:{style:{color:"white"}},inputProps:{maxLength:6},onChange:t=>k(t.target.value)})})]}),e.jsx(s,{sx:{display:"flex",justifyContent:"center",marginTop:"1rem"},children:u?e.jsx(j,{variant:"contained",onClick:N,color:"primary",children:"Confirm OTP"}):e.jsx(j,{variant:"outlined",onClick:B,color:"primary",children:"click here to sent OTP to your address number "})})]})]})};export{st as default};
